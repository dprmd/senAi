import{r as s,j as a}from"./pnpm-react@18.3.1--FUz9cRTN.js";import{u as L}from"./src-hooks-useUpdateProfilePhoto.js-Dxx_XhZ5.js";import{u as R}from"./src-store-useSettingsStore.js-BYM2pdyF.js";import{X as U,y as H,H as T,I as W}from"./pnpm-react-image-crop@11.0.6_react@18.3.1--DSzYCrTu.js";import{u as M}from"./pnpm-zustand@4.5.4_@types_react@18.3.3_react@18.3.1--EhdkWrrw.js";import{t as P}from"./src-components-ui-use-toast.js-w7cDmHIs.js";import{L as k}from"./src-components-composable-Loading.jsx-DQ2f1ITI.js";import{u as A}from"./pnpm-react-i18next@15.0.1_i18next@23.12.2_react-dom@18.3.1_react@18.3.1__react@18.3.1--C-fP4VmU.js";import{a as X}from"./pnpm-react-router@6.26.0_react@18.3.1--BYg1aRBq.js";import{m as D}from"./pnpm-framer-motion@11.3.22_react-dom@18.3.1_react@18.3.1__react@18.3.1--COr7I5SZ.js";const C=1,x=150,O=(t,l,n,f)=>{const o=l.getContext("2d");o||P({description:f("no_2d_context"),duration:3e3,variant:"destructive"});const c=window.devicePixelRatio,i=t.naturalWidth/t.width,h=t.naturalHeight/t.height;l.width=Math.floor(n.width*i*c),l.height=Math.floor(n.height*h*c),o.scale(c,c),o.imageSmoothingQuality="high",o.save();const b=n.x*i,d=n.y*h;o.translate(-b,-d),o.drawImage(t,0,0,t.naturalWidth,t.naturalHeight,0,0,t.naturalWidth,t.naturalHeight),o.restore()},$=()=>{const[t,l,n,f,o,c]=R(M(e=>[e.imageFile,e.setImageFile,e.haveSelectImageFile,e.setHaveSelectImageFile,e.loadingCompressImage,e.loadingUploadImage])),{t:i}=A(),h=X(),b=L(),d=s.useRef(null),v=s.useRef(null),[I,j]=s.useState(),[E,y]=s.useState(""),[N,_]=s.useState(!1),F=e=>{const{width:r,height:p}=e.currentTarget,m=x/r*100,g=T({unit:"%",width:m},C,r,p),u=W(g,r,p);j(u)},S=()=>{l(""),f(!1),h("/settings")};return s.useEffect(()=>{n||h("/settings")},[]),s.useEffect(()=>{const e=new FileReader,r=(m,g)=>{const{naturalWidth:u,naturalHeight:w}=m.currentTarget;if(u<x||w<x)return P({description:i("image_too_small"),variant:"destructive",duration:3e3}),S(),y("");y(g)},p=()=>{var u;const m=((u=e.result)==null?void 0:u.toString())||"",g=new Image;g.src=m,g.addEventListener("load",w=>{r(w,m)})};return e.addEventListener("load",p),n&&e.readAsDataURL(t),()=>{e.removeEventListener("load",p),l(""),f(!1)}},[]),a.jsxs(D.div,{className:"min-w-screen no-scrollbar z-30 flex min-h-screen flex-col items-center justify-start bg-white dark:bg-black",initial:{opacity:0,transition:{duration:.2}},animate:{opacity:1,transition:{duration:.2}},exit:{opacity:0,transition:{duration:.2}},children:[a.jsx("div",{className:"m-4 mb-[70px] flex max-h-max max-w-[400px] items-center justify-center",children:a.jsx(U,{onChange:(e,r)=>{j(r)},crop:I,circularCrop:!0,keepSelection:!0,aspect:C,minWidth:x,children:a.jsx("img",{ref:d,src:E,alt:"CroppedImage",className:"max-h-[450px] min-h-[150px] min-w-[150px] border border-slate-400 object-contain duration-100 dark:border dark:border-slate-600",onLoad:F})})}),a.jsxs("div",{className:"fixed bottom-0 left-0 right-0 flex h-[60px] items-center justify-center bg-white text-slate-900 dark:bg-black dark:text-slate-100",children:[a.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:S,children:i("cancel")}),a.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:async()=>{N||(O(d.current,v.current,H(I,d.current.width,d.current.height),i),await b(v.current)),_(!0)},children:i("done")})]}),I&&a.jsx("canvas",{ref:v,style:{display:"none",width:150,height:150,objectFit:"contain"},className:"mb-[140px]"}),o&&a.jsx(k,{message:i("loading_compress_image")}),c&&a.jsx(k,{message:i("loading_upload_image")})]})};export{$ as I};
